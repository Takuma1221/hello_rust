# コードコメントスタイルガイド

目的: 「なぜそう書いたか」を後で素早く思い出せるようにし、読み手の迷いを減らします。

## 原則

1. 「何をしているか」より「なぜこの選択か」。
2. 目で見て obvious な代入や get/set には付けない。
3. 外部 I/F、前提条件、落とし穴、計算根拠だけを書く。
4. 1〜2 行で収め、長くなる時は分割や関数化を検討。
5. 迷い/未決は `TODO:` `FIXME:` `NOTE:` で機械的に検索できる形に。

## 推奨フォーマット

- 単行: `// なぜ: ...` / `// 目的: ...`
- 複数行を多用しない (追従コスト増のため)。
- セクション境界は `// ===== <名前> =====`。

## タグ使用例

- `NOTE:` 削除/変更時に判断材料になる背景
- `TODO:` 近く対応予定 (放置しない)
- `FIXME:` 既知不具合。気付き次第優先度確認
- `SAFETY:` unsafe の安全根拠
- `PERF:` 最適化意図 (効果と前提)

## 具体例

```rust
// ===== 引数パース =====
// なぜ: モデルが返す arguments は JSON 文字列なので構造体に一度デコードする
#[derive(serde::Deserialize)]
struct SumArgs { a: f64, b: f64 }

fn calc_sum(a: f64, b: f64) -> f64 { a + b }

// TODO: ここを将来 Result<f64, ErrorKind> にしてエラー詳細を区別
```

## 避けるパターン

- 自明説明: `// a に 1 を足す`
- 大量のコメントアウトした古いコード (履歴で確認可能)
- 5 行以上のだらだら長文

## コメント配置指針

| ケース             | 置き場所       | 書く内容                     |
| ------------------ | -------------- | ---------------------------- |
| 関数の目的         | 関数直前       | 役割 / 副作用 / 返り値の意味 |
| 複雑な if / ループ | ブロック直前   | その判定理由 / 早期終了条件  |
| unsafe             | ブロック内最初 | メモリ・同期安全性の根拠     |
| 型/単位変換        | 行の直前       | 変換理由 / 元と先の単位      |

## コミット前チェック

- 仕様変更でコメントが古くなっていないか
- TODO/FIXME が無闇に増えていないか
- 用語ゆれ (例: tool_calls / toolcalls) が無いか

## 将来拡張案

- clippy カスタム lint で過多検知
- pre-commit で TODO 期限チェック

## 改訂履歴

- v1 (2025-09-13): 初版
- v1.1 (2025-09-13): 初学者向けに文面を丁寧化
